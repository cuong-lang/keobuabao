{% extends "layout.html" %}
{% block css %}
<link rel="stylesheet" type="text=/css" href="{{ url_for('static', filename='css/login.css') }}">
{% endblock css %}

{% block content %}
<div class="row">

    <div class="col-md-7">
        <h3>Thống kê người chơi</h3>

        <div class="card shadow-sm">
            <div class="card-body">
                <h4 class="card-title">{{ user.username }}</h4>
                <h6 class="card-subtitle mb-3 text-muted">Hạng hiện tại: {{ rank }}</h6>

                <ul class="list-group list-group-flush">

                    {% set played = user.get('played', 0) %}
                    {% set wins = user.get('wins', 0) %}
                    {% set losses = played - wins %}

                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Số trận đã chơi:
                        <span class="badge badge-primary badge-pill">{{ played }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Số trận thắng:
                        <span class="badge badge-success badge-pill">{{ wins }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Số trận thua:
                        <span class="badge badge-danger badge-pill">{{ losses }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <strong>Tỷ lệ thắng (Win Rate):</strong>
                        <strong>
                            {% if played > 0 %}
                                {% set win_rate = (wins / played) * 100 %}
                                {{ "%.2f"|format(win_rate) }}%
                            {% else %}
                                0.00%
                            {% endif %}
                        </strong>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="col-md-5">
        {% if user.username == username %}
            <h3>Đổi tên</h3>
            <form class="form-signin" action="{{url_for('main.profile_page', username=user.username)}}", method="POST">

                {{ form.csrf_token }}

                <div class="form-group">
                    {{ form.newUsername.label(class="form-label") }}

                    {{ form.newUsername(class="form-control" + (" is-invalid" if form.newUsername.errors else "")) }}
                    {% if form.newUsername.errors %}
                        <div class="invalid-feedback">
                            {% for error in form.newUsername.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <br>
                {{ form.submit(class="btn btn-dark btn-block") }}
            </form>
        {% endif %}

        <div class="mt-3">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else 'info' }}" role="alert">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
            {% endwith %}
        </div>
    </div>
</div>

{% endblock content%}