{% extends "layout.html" %}

{% block css %}
    <style>
        body { background: linear-gradient(135deg, #004d40, #00695c); color: white; }
        main.container { background: transparent; box-shadow: none; padding-top: 30px; }
        .hidden { display: none; }

        /* === B·ªê C·ª§C 2 C·ªòT (M·ªöI) === */
        .game-chat-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: flex-start;
        }
        .game-content {
            flex: 3; /* C·ªôt game chi·∫øm 3 ph·∫ßn */
            min-width: 400px;
        }
        .chat-sidebar {
            flex: 1; /* C·ªôt chat chi·∫øm 1 ph·∫ßn */
            min-width: 250px;
            background: rgba(0, 0, 0, 0.25);
            border-radius: 10px;
            padding: 15px;
            height: 600px;
            display: flex;
            flex-direction: column;
        }
        #chat-box {
            flex-grow: 1;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            padding: 10px;
            overflow-y: auto;
            margin-bottom: 10px;
            word-wrap: break-word;
        }
        #chat-box p { margin-bottom: 8px; }
        #chat-box em { color: #f1c40f; }
        #chat-form { display: flex; gap: 5px; }

        /* === S·ª¨A L·ªñI 1: ƒê·ªíNG B·ªò INPUT V·ªÄ N·ªÄN T·ªêI === */
        #chat-input,
        #baucua-lobby input {
            flex-grow: 1;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3); /* N·ªÅn t·ªëi */
            color: #ffffff; /* Ch·ªØ tr·∫Øng */
        }
        #chat-input::placeholder,
        #baucua-lobby input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        /* === K·∫æT TH√öC S·ª¨A L·ªñI 1 === */

        #chat-form button { background: #2ecc71; color: white; border: none; padding: 0 15px; border-radius: 5px; cursor: pointer; }
        #chat-form button:hover { background: #27ae60; }
        /* === K·∫æT TH√öC CSS CHAT === */

        /* CSS S·∫£nh ch·ªù */
        #baucua-lobby { text-align: center; max-width: 800px; margin: 0 auto; }
        #baucua-lobby input { max-width: 300px; margin: 0 auto 10px auto; } /* Gi·ªØ l·∫°i max-width */

        .room-list-container { margin-top: 40px; background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 10px; }
        .room-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; }

        /* === S·ª¨A L·ªñI 2: ƒê·ªîI M√ÄU XANH/X√ÅM SANG K√çNH M·ªú (GI·ªêNG LOBBY) === */
        .room-item {
            background: rgba(255, 255, 255, 0.06); /* N·ªÅn k√≠nh m·ªù */
            backdrop-filter: blur(10px);
            color: #fff;
            padding: 15px;
            border-radius: 12px; /* Bo g√≥c ƒë·∫πp h∆°n */
            text-decoration: none;
            transition: transform 0.2s, background 0.2s, border-color 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.15); /* Vi·ªÅn k√≠nh */
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .room-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1); /* Hover s√°ng h∆°n */
            border-color: #f1c40f; /* Gi·ªØ m√†u v√†ng hover */
            text-decoration: none;
            color: #f1c40f; /* Gi·ªØ m√†u v√†ng hover */
        }
        /* === K·∫æT TH√öC S·ª¨A L·ªñI 2 === */

        .room-item strong { font-size: 1.2rem; margin-bottom: 5px; }

        /* CSS Game (Gi·ªØ nguy√™n) */
        #baucua-game-area { text-align: center; background: rgba(0,0,0,0.2); padding: 30px; border-radius: 15px; }
        #baucua-timer-display { font-size: 2rem; font-weight: bold; color: #f1c40f; }
        .betting-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 30px 0; }
        .bet-button { font-size: 2.5rem; min-height: 100px; border-radius: 15px; border: 3px solid white; position: relative; padding-top: 15px; transition: all 0.3s ease; }
        .bet-button .bet-payout { font-size: 1rem; font-weight: bold; color: #f1c40f; display: block; }
        .bet-button .bet-amount { position: absolute; bottom: -10px; right: -10px; background: #f1c40f; color: #333; border-radius: 50%; width: 40px; height: 40px; line-height: 40px; font-size: 1rem; font-weight: bold; border: 2px solid white; }
        #dice-results { display: flex; justify-content: center; gap: 20px; margin-top: 20px; min-height: 100px; }
        .die { font-size: 4rem; width: 100px; height: 100px; line-height: 100px; border-radius: 15px; background: rgba(255,255,255,0.8); color: #333; transition: all 0.5s ease; }
        .die.rolled { transform: scale(1) rotate(360deg); }
        #baucua-message { font-size: 1.5rem; margin-top: 20px; color: #f1c40f; font-weight: bold; }
        #baucua-player-list { list-style: none; padding: 0; margin-top: 15px; }
        #baucua-player-list li { background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 5px; margin-bottom: 5px; display: inline-block; margin: 5px; }
    </style>
{% endblock %}

{% block content %}

<div class="game-chat-wrapper">

    <div class="game-content">

        <div id="baucua-lobby">
            <h1 class="mb-4"> S·∫£nh Ch·∫ø ƒê·ªô</h1>
            <p>T·∫°o ph√≤ng m·ªõi ho·∫∑c ch·ªçn ph√≤ng b√™n d∆∞·ªõi ƒë·ªÉ tham gia.</p>

            <div class="row d-flex justify-content-center mb-4">
                <div class="col-md-6">
                    <input type="text" id="baucua-room-input" class="form-control mb-2" placeholder="Nh·∫≠p m√£ ph√≤ng t√πy √Ω (VD: VIP1)">
                    <button id="baucua-create-btn" class="btn btn-success btn-lg btn-block">T·∫°o Ph√≤ng M·ªõi</button>
                </div>
            </div>

            <a href="{{ url_for('main.lobby_page') }}" class="btn btn-secondary">Quay v·ªÅ S·∫£nh Ch√≠nh</a>

            <div class="room-list-container">
                <h3>üìã Danh s√°ch ph√≤ng ƒëang ch·ªù</h3>
                <div class="room-grid">
                    {% if rooms %}
                        {% for r_id, r_data in rooms.items() %}
                            <a href="/game_baucua/{{ r_id }}" class="room-item">
                                <strong>{{ r_id }}</strong>
                                <span><i class="fas fa-users"></i> {{ r_data['players']|length }} ng∆∞·ªùi ch∆°i</span>
                                <span style="font-size: 0.8em; color: #2ecc71; margin-top:5px;">ƒêang ho·∫°t ƒë·ªông</span>
                            </a>
                        {% endfor %}
                    {% else %}
                        <p class="mt-3">Ch∆∞a c√≥ ph√≤ng n√†o ƒë∆∞·ª£c t·∫°o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div id="baucua-game-area" class="hidden">
            <h1 id="baucua-timer-display">ƒêang ch·ªù ng∆∞·ªùi ch∆°i...</h1>
            <h3 id="baucua-message"></h3>
            <div>
                <strong>Ng∆∞·ªùi ch∆°i:</strong>
                <ul id="baucua-player-list"></ul>
            </div>

            <div class="betting-grid" id="betting-grid">
                <button class="btn btn-primary bet-button" data-bet="rockrock">‚úä‚úä <span class="bet-payout">x3</span><span class="bet-amount" id="bet-rockrock"></span></button>
                <button class="btn btn-info bet-button" data-bet="paperpaper">‚úã‚úã <span class="bet-payout">x3</span><span class="bet-amount" id="bet-paperpaper"></span></button>
                <button class="btn btn-danger bet-button" data-bet="scissorscissor">‚úåÔ∏è‚úåÔ∏è <span class="bet-payout">x3</span><span class="bet-amount" id="bet-scissorscissor"></span></button>
                <button class="btn btn-secondary bet-button" data-bet="paperrock">‚úä‚úã <span class="bet-payout">x3</span><span class="bet-amount" id="bet-paperrock"></span></button>
                <button class="btn btn-secondary bet-button" data-bet="rockscissor">‚úä‚úåÔ∏è <span class="bet-payout">x3</span><span class="bet-amount" id="bet-rockscissor"></span></button>
                <button class="btn btn-secondary bet-button" data-bet="paperscissor">‚úã‚úåÔ∏è <span class="bet-payout">x3</span><span class="bet-amount" id="bet-paperscissor"></span></button>
            </div>

            <div id="dice-results">
                <div id="die1" class="die">?</div>
                <div id="die2" class="die">?</div>
            </div>

            <button id="baucua-leave-btn" class="btn btn-warning btn-lg mt-4">R·ªùi Ph√≤ng</button>
        </div>

    </div> <div class="chat-sidebar">
        <h3><i class="fas fa-comments"></i> Chat Ph√≤ng</h3>
        <div id="chat-box">
            <p><em>Ch√†o m·ª´ng b·∫°n! Gi·ªØ l·ªãch s·ª± khi chat nh√©.</em></p>
        </div>
        <form id="chat-form">
            <input type="text" id="chat-input" placeholder="Nh·∫≠p tin nh·∫Øn..." autocomplete="off" required>
            <button type="submit">G·ª≠i</button>
        </form>
    </div> </div> {% endblock %}

{% block scripts %}
    <script type="text/javascript">
        const username = `{{ username }}`;
        const currentRoomId = `{{ room_id if room_id else '' }}`;
    </script>
    <script src="{{ url_for('static', filename='baucua.js') }}"></script>
{% endblock %}