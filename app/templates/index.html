<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>K√©o B√∫a Bao Online</title>
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<style>
/* === GIAO DI·ªÜN M·ªöI (KH·ªöP V·ªöI LOBBY) === */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

body {
    font-family: 'Inter', Arial, sans-serif;
    text-align: center;
    background: linear-gradient(135deg, #1f0c2e 0%, #3a1a54 100%);
    color: #ecf0f1;
    margin: 0;
    padding: 30px;
    min-height: 100vh;
}

h1 {
    color: white;
    font-weight: 700;
    text-shadow: 0 0 10px rgba(255,255,255,0.3);
}

/* Th·∫ª "Glassmorphism" cho khu v·ª±c ƒëi·ªÅu khi·ªÉn */
.game-controls {
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(12px);
    padding: 25px 30px;
    border-radius: 18px;
    border: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    max-width: 500px;
    margin: 20px auto;
}

/* Input n·ªÅn t·ªëi */
input {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #ffffff;
    border-radius: 8px;
    padding: 12px;
    margin: 5px;
    font-size: 1rem;
    width: 200px;
}
input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

/* N√∫t b·∫•m gradient (gi·ªëng lobby) */
button {
    font-weight: 600;
    padding: 12px 18px;
    border-radius: 8px;
    background: linear-gradient(135deg, #6a11cb, #2575fc);
    border: none;
    color: white;
    cursor: pointer;
    transition: 0.25s ease;
    margin: 5px;
}
button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

/* === S·ª¨A CSS: N√∫t R·ªùi Ph√≤ng === */
#leave-btn {
    background: #e74c3c; /* M√†u ƒë·ªè */
    margin-top: 20px;
}
#leave-btn:hover {
    background: #c0392b;
}

/* === TH√äM CSS CHO N√öT QUAY V·ªÄ S·∫¢NH === */
#back-to-lobby-btn {
    display: inline-block; /* Bi·∫øn th·∫ª <a> th√†nh n√∫t */
    font-weight: 600;
    padding: 12px 18px;
    border-radius: 8px;
    background: #6c757d; /* M√†u x√°m (secondary) */
    border: none;
    color: white;
    cursor: pointer;
    transition: 0.25s ease;
    margin: 5px;
    margin-top: 20px;
    text-decoration: none; /* B·ªè g·∫°ch ch√¢n */
}
#back-to-lobby-btn:hover {
    background: #5a6268;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}
/* === K·∫æT TH√öC TH√äM CSS === */


/* Th√¥ng tin ph√≤ng */
#info {
    color: #f1c40f;
    font-size: 1.3rem;
    font-weight: bold;
    margin-top: 15px;
}

/* T√™n v√† T·ª∑ s·ªë */
.player-names {
    display: flex;
    justify-content: center;
    gap: 80px;
    font-size: 1.5rem;
    font-weight: 600;
    margin: 25px 0;
    background: rgba(0, 0, 0, 0.2);
    padding: 15px;
    border-radius: 12px;
    max-width: 600px;
    margin: 20px auto;
}

/* B·ªô b√†i (Deck) */
#deck {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 25px;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
}
#deck img {
    width: 120px;
    height: 120px;
    border-radius: 16px;
    border: 3px solid rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.1);
    padding: 10px;
    box-sizing: border-box;
    cursor: pointer;
    transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
}
#deck img:hover {
    transform: scale(1.1);
    border-color: #f1c40f; /* V√†ng */
}
#deck img.selected {
    transform: scale(1.1);
    border-color: #2ecc71; /* Xanh l√° */
    box-shadow: 0 0 20px #2ecc71;
}

/* K·∫øt qu·∫£ */
#result {
    color: #f1c40f; /* V√†ng */
    font-weight: bold;
    margin-top: 25px;
    white-space: pre-line;
    font-size: 1.2rem;
    background: rgba(0, 0, 0, 0.25);
    padding: 20px;
    border-radius: 12px;
    max-width: 600px;
    margin: 20px auto;
    line-height: 1.6;
}
</style>
</head>
<body>
<h1>üé¥ O·∫≥n T√π T√¨ (Th·∫ª B√†i) üé¥</h1>

<div class="game-controls">
  <input id="name" placeholder="T√™n b·∫°n">
  <input id="roomId" placeholder="M√£ ph√≤ng">
  <br>
  <button onclick="createRoom()">T·∫°o ph√≤ng</button>
  <button onclick="joinRoom()">Tham gia</button>
</div>

<div id="info"></div>
<div id="players"></div>
<div id="deck"></div>
<div id="result"></div>

<button id="leave-btn" onclick="leaveGame()" style="display: none;">R·ªùi Ph√≤ng</button>

<a id="back-to-lobby-btn" href="{{ url_for('main.lobby_page') }}">Quay v·ªÅ S·∫£nh Ch√≠nh</a>


<script>
// D√≤ng n√†y s·∫Ω t·ª± ƒë·ªông k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß ƒë√£ g·ªôp (port 8080)
let socket = io();
let selfName='', opponentName='', roomId='', deck=[], selectedCard=null;

socket.on('room_created', d=>{
  roomId = d.roomId;
  document.getElementById('info').innerText = 'Ph√≤ng: ' + roomId;
  document.querySelector('.game-controls').style.display = 'none';
  document.getElementById('leave-btn').style.display = 'inline-block';
});

socket.on('updateDeck', d=>{
  selfName = d.selfName;
  opponentName = d.opponentName;
  deck = d.deck;
  roomId = d.roomId;
  renderDeck();
  renderPlayerInfo();
  document.querySelector('.game-controls').style.display = 'none';
  document.getElementById('leave-btn').style.display = 'inline-block';
});

socket.on('roundResult', d=>{
  deck = d.deck;
  renderDeck();
  showResult(d);
  updateScore(d.score);
});

socket.on('opponentLeft', d=> alert(d.msg));

function createRoom(){
  let n = document.getElementById('name').value.trim();
  let r = document.getElementById('roomId').value.trim();
  if(!n) return alert('Nh·∫≠p t√™n!');
  if(!r) return alert('Vui l√≤ng nh·∫≠p M√£ ph√≤ng!');
  socket.emit('createRoom',{
      name: n,
      room_id_custom: r
  });
}

function joinRoom(){
  let n = document.getElementById('name').value.trim();
  let r = document.getElementById('roomId').value.trim();
  if(!n||!r) return alert('Nh·∫≠p ƒë·ªß th√¥ng tin!');
  socket.emit('joinRoom',{name:n, roomId:r});
}

function playCard(c){
  selectedCard=c;
  document.querySelectorAll('#deck img').forEach(i=>i.classList.remove('selected'));
  let img=document.querySelector(`#deck img[title="${c}"]`);
  if(img) img.classList.add('selected');
  socket.emit('playCard',{roomId:roomId, card:c});
}

function leaveGame(){
  if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën r·ªùi ph√≤ng?")) {
    socket.emit('leave_card_room', { roomId: roomId });
    window.location.reload();
  }
}

function renderDeck(){
    let html='';
    deck.forEach(c=>{
        let img='';
        if(c=='K√©o') img="{{ url_for('static', filename='images/keo.png') }}";
        if(c=='B√∫a') img="{{ url_for('static', filename='images/bua.png') }}";
        if(c=='Bao') img="{{ url_for('static', filename='images/bao.png') }}";
        html+=`<img src="${img}" title="${c}" onclick="playCard('${c}')">`;
    });
  document.getElementById('deck').innerHTML = html;
}

function renderPlayerInfo(){
  document.getElementById('players').innerHTML =
    `<div class="player-names">
       <div>${selfName}: <span id="score-self">0</span></div>
       <div>${opponentName}: <span id="score-opponent">0</span></div>
     </div>`;
}

function updateScore(scores){
  document.getElementById('score-self').innerText = scores[selfName] || 0;
  document.getElementById('score-opponent').innerText = scores[opponentName] || 0;
}

function showResult(d){
  let r = document.getElementById('result');
  r.innerText = `${d.p1Card.name} ch·ªçn ${d.p1Card.card}
${d.p2Card.name} ch·ªçn ${d.p2Card.card}
üëâ ${d.resultText}`;
}
</script>
</body>
</html>